name: User service build and push image CI
# This workflow is triggered on pushes to the /microservices/user/app/ directory, to the pre-prod branch.
on:
  push:
    paths:
      - 'microservices/user/app/**'
    branches:
      - pre-prod

jobs:
  build-and-push:
    name: Docker Build User and push image
    runs-on: ubuntu-18.04
    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Build and push User Docker image
        # Official docker action: https://github.com/docker/build-push-action
        uses: docker/build-push-action@v1.1.0
        with:
          username: ${{ github.actor }}
          password: ${{ github.token }}
          registry: docker.pkg.github.com
          # github.repository -> alexandr-io/backend
          # https://github.com/docker/build-push-action/pull/14/files/d1c5c2f87bcd65b263d72ea6b1861bb25cbbcda5#r429877166
          repository: ${{github.repository}}/user
          tag_with_sha: true # for simplified versioning
          path: microservices/user/app
          push: true
